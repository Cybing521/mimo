# MIMO仿真运行指南

## 快速开始

### 1. 激活虚拟环境

```bash
# macOS/Linux
source venv/bin/activate

# Windows
venv\Scripts\activate
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

如果安装过程中遇到问题，可以尝试：
```bash
pip install --upgrade pip
pip install numpy scipy cvxpy matplotlib
```

### 3. 运行仿真

#### 方式A: 运行完全复现版（包含原问题）

```bash
python mimo_exact_reproduction.py
```

**特点**:
- 完全按照MATLAB逻辑复现
- 包含原代码的所有问题
- 用于对比和验证

**预期行为**:
- 运行时间: 约30-60分钟（取决于电脑性能）
- 可能看到容量曲线的突变
- 小区域（A/λ=1-2）时容量明显偏低

#### 方式B: 运行优化版

```bash
python mimo_optimized.py
```

**特点**:
- 修复了所有已知问题
- 性能和稳定性显著提升
- 推荐用于实际研究

**预期行为**:
- 运行时间: 约40-80分钟
- 容量曲线平滑过渡
- 初始化成功率接近100%
- 会显示实时成功率统计

---

## 输出结果

### 图像文件

- `capacity_exact_reproduction.png`: 完全复现版的结果图
- `capacity_optimized.png`: 优化版的结果图

### 控制台输出示例

```
处理 Lr = 15
  A/λ = 1, 进行 1000 次试验...
    试验 100/1000, 成功率: 98.0%
    试验 200/1000, 成功率: 97.5%
    ...
    平均容量 = 12.3456 bps/Hz (成功率: 97.2%)
  A/λ = 2, 进行 1000 次试验...
    ...
```

---

## 参数调整（高级）

如果想快速测试或调整参数，可以修改脚本开头的参数：

### 减少计算时间（用于测试）

```python
# 在main()函数中修改
num_trials = 100  # 原值1000，减少到100可快速看到结果
A_lambda_values = np.arange(1, 5)  # 只测试1-4
```

### 调整系统参数

```python
# 在trial循环内修改
SNR_dB = 20  # 改变信噪比（默认15）
M = 4        # 接收天线数（建议不要改）
Lt = 10      # 散射体数量
```

### 调整优化参数

```python
# 在外层循环修改
for outer_iter in range(30):  # 减少外循环迭代次数（原50）

# 在内层循环修改
for sca_iter in range(30):     # 减少SCA迭代次数（原60）
```

---

## 常见问题

### Q1: CVX求解器报错

**错误信息**: `SolverError: Solver 'SCS' failed`

**解决方案**:
```bash
# 更新CVXPY
pip install --upgrade cvxpy

# 或者安装其他求解器
pip install cvxopt
```

然后在代码中尝试其他求解器：
```python
prob.solve(solver=cp.CVXOPT, verbose=False)
```

### Q2: 内存不足

**症状**: 程序运行一段时间后崩溃

**解决方案**:
- 减少`num_trials`（如改为500或200）
- 减少测试的`A_lambda_values`范围
- 关闭其他占用内存的程序

### Q3: 运行速度太慢

**优化建议**:
1. 使用优化版而非复现版（优化版虽然单次迭代慢但收敛快）
2. 减少试验次数
3. 使用并行计算（需要修改代码）

### Q4: 初始化失败

**错误信息**: `RuntimeError: 无法初始化合法位置`

**原因**: 区域太小，无法放置4个天线且满足最小距离约束

**解决方案**:
- 优化版已经显著改善此问题
- 如果仍然失败，可以考虑：
  - 增加`square_size`（调大A/λ）
  - 减少天线数`M`
  - 减小最小距离`D`（不推荐，会影响物理可实现性）

---

## 结果解读

### 容量曲线分析

**正常趋势**:
- A/λ较小时（1-3）: 容量较低且增长较快
- A/λ中等时（3-5）: 容量稳定增长
- A/λ较大时（6-8）: 容量趋于饱和，增长变慢

**原因**:
- 小区域: 天线间相互干扰严重，优化受限
- 大区域: 天线有足够空间优化位置，但增益递减

### Lr的影响

- **Lr=15**: 散射体多，多径丰富，容量通常更高
- **Lr=10**: 散射体少，多径有限，容量较低

但Lr越大，优化难度也越大。

---

## 进阶使用

### 1. 保存详细结果

可以修改代码保存每次试验的结果：

```python
# 在main()函数末尾添加
np.save('results.npy', {
    'capacity': average_capacity_Proposed,
    'A_lambda': A_lambda_values,
    'Lr': Lr_values
})
```

### 2. 绘制更多曲线

```python
# 添加标准差等信息
capacity_std = np.std(capacity_trials)
plt.errorbar(A_lambda_values, average_capacity_Proposed[:, 0], 
             yerr=capacity_std, fmt='o-')
```

### 3. 并行化加速

使用`multiprocessing`对试验并行：
```python
from multiprocessing import Pool

def run_single_trial(args):
    # 单次试验的代码
    ...

with Pool(processes=4) as pool:
    results = pool.map(run_single_trial, trial_args)
```

---

## 环境要求

- **Python**: 3.8或更高
- **内存**: 建议4GB以上
- **CPU**: 多核处理器（虽然代码未并行化，但求解器会利用多核）
- **运行时间**: 单核约1小时，实际取决于硬件

---

## 技术支持

如遇到问题，请检查：
1. Python版本是否正确
2. 依赖包是否完整安装
3. 虚拟环境是否正确激活
4. 参数设置是否合理

详细的问题分析请参考：`问题分析报告.md`
